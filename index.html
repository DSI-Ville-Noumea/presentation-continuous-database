<html>
    <head>
        <title>Database without dba</title>
        <link rel="stylesheet" href="css/reveal.css">

        <link rel="stylesheet" href="css/theme/moon.css" id="theme">

        <!-- If the query includes 'print-pdf', include the PDF print sheet -->
        <script>
            if (window.location.search.match(/print-pdf/gi)) {
                var link = document.createElement('link');

                link.rel = 'stylesheet';
                link.type = 'text/css';
                link.href = 'css/print/pdf.css';
                document.getElementsByTagName('head')[0].appendChild(link);
            }
        </script>

    </head>
    <body>
        <div class="reveal">
            <div class="slides">
                

                <section>
                    <h1>Database without dba</h1>
                    <h2>An Agile/DevOps Database approach for (very) little teams.</h2>
                    <p><a href="https://github.com/DSI-Ville-Noumea">Adrien Sales/Ville de Noumea</a></p>
                </section>
                
                <section>
                    <h1>DevOps</h1>
                    <h2>Goals</h2>
                    <ul>
                        <li>Increase Application uptime</li>
                        <li>Reduce overall IT spent on Infrastructure</li>
                        <li>Increase release velocities : faster and more often</li>
                    </ul>
                </section>
                
                <section>
                    <h1>What is DevOps</h1>
                    <h2>in a few words</h2>
                    <ul>
                        <li>Collab between IT professionals</li>
                        <li>Culture of (operational) continuous improvement : facts rather than philosophy</li>
                        <li><i>Not a prescribed set of practices, but rather high depending on teams, technologies and processes which make up organization</i></li>
                    </ul>
                </section>
                
                <section>
                    <h1>Communication</h1>
                    <h2>the core</h2>
                    <ul>
                        <li>Educate each other</li>
                        <li>Understand what matters most to their counterparts</li>
                        <li>Dev understanding how underlying systems are configured/working : knowledge of impact of changes between dev and prod</li>
                        <li>Empathy between the different IT stakeholders</li>
                        <li>As empaty grows in the IT Org. teams begin naturally come together to collaborate</li>
                        <li>Egocentric vs. hollistic view of the system and collaboration to optimize the value stream</li>
                    </ul>
                </section>
                
                <section>
                    <h1>Shifting Left</h1>
                    <h2></h2>
                    <ul>
                        <li>Bringing production concerns further left in the develop/test/deploy cycle</li>
                        <li>Making note of specific concerns that will need to be addressed for the push to production</li>
                        <li>Working on issues before they become issues</li>
                        <li>Reduce time and resource spent in troubleshooting</li>
                    </ul>
                </section>
                
                <section>
                    <h2>Cost of a Bugfix</h2>
                    <img src="img/relative-cost-of-a-bugfix.png" alt="Relative Cost Of a Bugfix"/>
                </section>

                <section data-background="black">
                    <p><i>Not automating every process, but rather only those tasks that are manual,
                            rote, tedious aspects of the job and consume a great deal of your time.</i></p>
                </section>
                
                <section data-background="black">
                    <p><i>Free up time for IT pros. to think about more strategic issues, and spend more
                            time collaborating with other groups to driver additional value through innovation
                            in their products and services.</i></p>
                </section>
                
                
                <section>
                    <h2>Benefits</h2>
                    <h3></h3>
                    <ul>
                        <li>Environments more in sync</li>
                        <li>More testing environments (and easier to reproduce/fix bugs), see previous slide</li>
                        <li></li>
                        <li></li>
                        <li></li>
                    </ul>
                </section>
                <!-- real life -->
                <section>
                    <h2>The sentences that triggered everything</h2>
                    <h3>Make life easier</h3>
                    <ul>
                        <li>We cannot guarantee you that we'll run the right sql script on
                            the right database nor on the right environment</li>
                        <li>We'd like to only run (simple) system command lines and
                            not having to deal with databases (even db client tools)</li>
                        <li>It's time consuming to connect to databases to run sql on them
                            and we think we don't provide any added value while doing this</li>
                    </ul>
                </section>
                
                
                

                <section>
                    <h2>The sentences that triggered everything</h2>
                    <h3>DBA added value tasks</h3>
                    <ul>
                        <li>We are not comfortable with database schema upgrades</li>
                        <li>We don't have time to read the sqls you provide : we
                            do pass them as provided without checking potential design
                            issues and we don't necessarly have the required knowledge</li>
                    </ul>
                </section>



                <section>
                    <h2>Still remembering that day...</h2>
                    <p>
                        <img src="http://i.giphy.com/26tP0ajQqkYICLDsQ.gif"/>
                    </p>
                </section>

                <section>
                    <h2>...and finding opportunities.</h2>
                    <p>
                        <img src="http://i.giphy.com/cpRQzY4VS3V3W.gif"/>
                    </p>
                </section>



                <section>
                    <h2>Agility, flexibiliy</h2>
                    <ul>
                        <li>from weakness to opportunities</li>
                        <li>automate everything</li>
                        <li>version/tag anything</li>
                        <li>threat database like any other system component</li>
                        <li>manage databases as code</li>
                        <li>push code to databases without having to give human access to them</li>
                    </ul>
                </section>

                <section>
                    <h2>Motivations</h2>
                    <ul>
                        <li>No production DBA</li>
                        <li>Architect/developer who was previously Oracle/PgSql production DBA</li>
                        <li>Sysadmins focused on automation</li>
                        <li>Focus on automation for all</li>
                        <li>Motivation to deploy faster/more with no specific database knowledge</li>
                        <li>Wish to version everything</li>
                        <li>No resource/time to test database design quality in the production team but focus on these aspects on the dev side</li>
                        <li>All Linux users and commited in open source development and tools</li>
                    </ul>
                </section>

                <section>
                    <h2>Team</h2>
                    <h3>Dev and Ops</h3>
                    <ul>
                        <li><a href="https://www.linkedin.com/in/david-majorel-a0a58736">David Majorel</a>/<a href="http://www.opt.nc/">opt.nc</a> (sysadmin/architect/ansible)</li>
                        <li><a href="https://www.linkedin.com/in/adrien-sales-898b7270">Adrien Sales</a>/<a href="https://github.com/DSI-Ville-Noumea">Noumea City</a> (architect/dev/dba knowledge)</li>
                        <li><a href="https://www.linkedin.com/in/mich%C3%A8le-barr%C3%A9-2652b06">Michele Barre</a>/<a href="https://github.com/DSI-Ville-Noumea">Noumea City</a> (java/j2ee developer)</li>
                        <li><a href="https://www.linkedin.com/in/melaniegault">Melanie Gault</a>/<a href="https://github.com/DSI-Ville-Noumea">Noumea City</a> (sysadmin/architect/puppet)</li>
                        <li><a href="https://www.linkedin.com/in/sualeh">Sualeh Fatehi</a>/<a href="http://sualeh.github.io/SchemaCrawler/">Schemacrawler</a> (schemacrawler lead developer)</li>
                    </ul>
                </section>
                
                
                
                <section>
                    <h2>Roadmap</h2>
                    <h3>Achieved today</h3>
                    <ol>
                        <li>Deploy & upgrade databases schemas easier</li>
                        <li>Document database schema in an automated way</li>
                        <li>Keep in mind that we could one day have a dba and hence provide him the tools to review the sql dev team send in input</li>
                        <li>Check and report database design issues</li>
                    </ol>
                </section>

                <section>
                    <h2>Tools</h2>
                    <ul>
                        <li><a href="http://www.liquibase.org/">Liquibase</a> : <i>"source control for your database"</i></li>
                        <li><a href="http://sualeh.github.io/SchemaCrawler/">Schemacrawler</a> : schema discovery and comprehension tool</li>
                    </ul>
                </section>
                
                 <section>
                    <h2>Tools</h2>
                    <h3>Liquibase</h3>
                    <img src="http://www.liquibase.org/custom_images/home_tagline.png" alt="Liquibase logo"/>
                </section>
                
                <section>
                    <h2>Security</h2>
                    <ul>
                        <li>We don't want apps (war) to upgrade database themselves</li>
                        <li>Apps are connecting to db with dedicated accounts that can only execute DML : datasource cannot add column/drop table</li>
                        <li>Table privileges are fine grained</li>
                        <li>Apps connect to db through a dedicated user : privileges are granted to him, table names are resolved by synonyms/search_path</li>
                        <li>DDL queries are only run by liquibase commands (adm_users)</li>
                        <li>adm_users are not granted to connect from app servers (tomcat)</li>
                    </ul>
                </section>

                <section>
                    <h2>Upgrading databases : from</h2>
                    <h3>From ...</h3>
                    <ol>
                        <li>Get the sql</li>
                        <li>Get, install (and maintain) the open the dedicated db client</li>
                        <li>Connect to the right db on the right env</li>
                        <li>Check that you don't have already played this sql</li>
                        <li>Run the sql</li>
                        <li>Check that all required sql have all been passed, and in the right order</li>
                    </ol>
                </section>
                <section>
                    <h2>... and some nice questions</h2>
                    <ol>
                        <li>Did i really already run this sql ?</li>
                        <li>What are the pending sql on this schema ?</li>
                        <li>I'm not sure if everything is fine : can i re-run the sql ?... to be sure ?</li>
                        <li>Something's wrong on the prod db vs dev one : are you sure you ran the same sqls on both ? If not, what is the delta ?</li>
                    </ol>
                </section>
                <section data-background="black">
                    <h2>to.</h2>
                    <h3>Puppetized Liquibase install</h3>
                    <pre><code>
class profiles::liquibase {
  $version      = hiera('liquibase::version')
  class { 'liquibase':
  version      => $version,
  }
}
                    </code></pre>
                </section>
                
                
                <section data-background="black">
                    <h2>to.</h2>
                    <h3>Schema upgrade</h3>
                    <pre><code>
export TARGET_VERSION=1.04.00
cd liquibase
# Switch to tag
git checkout tags/${TARGET_VERSION}
# report pending upgrades (dba not done, but review possible)
liquibase dbDoc ./dbDoc
# perform upgrade
liquibase update
                    </code></pre>
                </section>
                
                <section>
                    <h2>Key concepts</h2>
                    <ul>
                        <li>the "changelog"</li>
                        <li>the "changeset"</li>
                        <li>databasechangelog : id, author, dateexecuted, orderexecuted, md5sum, description, comments, ...</li>
                    </ul>
                </section>
                
                <section>
                    <h2>The hash*@%! ? WHAT ?</h2>
                    <p><i>"I can't apply my databasechangelog : liquibase is complaining that the code that has already been deployed on my db ?!!"</i></p>
                </section>
                
                <section data-background="black">
                    <p><i>Yep buddy, that's normal and it's pretty cool, just add a new changeset to patch your previous one and other people will be happy ;-p</i></p>
                    <img src="http://i.giphy.com/3oFyDl7xbRgcAu8O8E.gif" alt="fun"/>
                    
                </section>
                
                
                

                <section data-background="black">
                    <h2>databasechangelog overview</h2>
                    <pre><code>
                   id                    |       author        |        dateexecuted        | orderexecuted |               md5sum               |                     description                     | liquibase 
-----------------------------------------+---------------------+----------------------------+---------------+------------------------------------+-----------------------------------------------------+-----------
 1417670162732-1                         | salad74             | 2015-07-21 10:24:54.721108 |             1 | 7:1d454f92543dfc2f97501ba16669c6d7 | createSequence                                      | 3.3.2
 1417670162732-2                         | salad74             | 2015-07-21 10:24:54.739246 |             2 | 7:820672cebd4d2c7adf8de021c9304788 | createSequence                                      | 3.3.2
 1417670162732-3                         | salad74             | 2015-07-21 10:24:54.752848 |             3 | 7:28470b521a8be561e0cbde2053257007 | createSequence                                      | 3.3.2
 1417670162732-4                         | salad74             | 2015-07-21 10:24:54.764076 |             4 | 7:c86dbe6244a166da8335b66c17a1a16a | createSequence                                      | 3.3.2

                    </code></pre>
                </section>
                
                
                <section>
                    <h2>Liquibase</h2>
                    <h3>Used features</h3>
                    <ul>
                        <li>Code branching and merging</li>
                        <li>Multiple developers (on git)</li>
                        <li>Multiple database types</li>
                        <li>Supports context-dependent logic : partially</li>
                        <li>Generate Database change documentation</li>
                        <li>Generate Database "diffs" : check if ERP changes db schema</li>
                        <li>Automatically generate SQL scripts for DBA code review</li>
                        <li>Open Source: Apache 2.0 License : code donation, public roadmap</li>
                        <li>Java APIs for executing and embedding</li>
                        <li>Generate database Changelog</li>
                        <li>Extensions : db2i for AS400->PgSql Migrations</li>
                    </ul>
                </section>
                <section>
                    <h2>Liquibase</h2>
                    <h3>Not (yet) used features</h3>
                    <ul>
                        <li>Tags</li>
                        <li>Contexts</li>
                    </ul>
                </section>
                
                <section>
                    <h2>Real life scenarios</h2>
                    <ul>
                        <li>Standard db schema upgrades</li>
                        <li>Database schema creation (liquibase for dbas)</li>
                        <li>Parameter tables feeding</li>
                        <li>Database migration (Oracle to PostgreSql) and data
                            patching : final live migration (with datas) operated
                            within less than 3 minutes !</li>
                        <li>Database migration (DB2/400 to PostgreSql)</li>
                    </ul>
                </section>

                
                <section>
                    <h2>The "liquibase dilemma"</h2>
                    <p>Should i recreate a non "liquified" database to get
                        the whole db changelog or should i construct liquibase
                        on legacy created tables ?</p>
                </section>

                <section>
                    <h2>Liquibase Code donations</h2>
                    <ul>
                        <li>deb and rpm installers, merged in base source code, now part of official release</li>
                        <li>Puppet module (soon released to open source)</li>
                        <li>Some bug fixes (with related unit tests)</li>
                    </ul>
                </section>

                <section>
                    <h2>Links and resources</h2>
                    <ul>
                        <li><a href="http://fr.slideshare.net/MlanieGault/201406automatisation-de-la-productionsieinfra">Production automation</a></li>
                        <li><a href="http://www.datical.com/wp-content/uploads/White-Paper-The-DBAs-Roles-in-DevOps.pdf">The DBA's Role in Devops</a> by <a href="http://www.datical.com">Datical</a> (Enterprise Liquibase Edition and much more)</li>
                    </ul>
                </section>
                
                
                <section>
                    <h2>Tools</h2>
                    <h3>Schemacrawler</h3>
                    <img src="http://static.open-open.com/news/uploadImg/20111018/20111018084744_195.png" alt="Schemacrawler logo"/>
                </section>
                
                <!-- The schemacrawler part -->
                <section>
                    <h2>Now you have a database ...</h2>
                    <h3>How to better understand it, check and test its design quality ...</h3>
                    <ul>
                        <li>Better understand database design/relations</li>
                        <li>Draw database diagrams</li>
                        <li>Lints : check/detect/test and report design quality</li>
                    </ul>
                </section>
                
                <section>
                    <h2>Side goals</h2>
                    <ul>
                        <li>Giving a developer open source development experience</li>
                        <li>Getting control on our tools</li>
                        <li>Opportunities to learn by practice (git, continuous build, SaaS services, collaboration) on up-to-date technologies</li>
                        <li>Taking part in open source community</li>
                        <li>Contributing to production automation</li>
                        <li>Having fun and develop cool tools</li>
                        <li>Code coverage challenging</li>
                        <li>Protyping POCs</li>
                    </ul>
                </section>
                
                <section>
                    <h2>Schemacrawler (Code) donations</h2>
                    <ul>
                        <li>deb and rpm installers</li>
                        <li>fully crossplatform installer, Izpack based</li>
                        <li>Some bug reports</li>
                        
                    </ul>
                </section>
                
                
                
                <section>
                    <h2>Tools used to produce this slideshow (collaborative mode)</h2>
                    <h3>This slideshow has been developped like any other code</h3>
                    <ul>
                        <li>Reveal.js</li>
                        <li>Github</li>
                        <li>Any text editor : Kate, Atom, vim</li>
                        <li>git client</li>
                        <li>Web browser</li>
                        
                    </ul>
                </section>
                
                
                <!-- ---------------------------------------          -->
                <section data-background="#ff0000">
                    <h2>All CSS color formats are supported, like rgba() or hsl().</h2>
                </section>

                <section data-background="#ff0000">
                    <h2>All CSS color formats are supported, like rgba() or hsl().</h2>
                </section>
                <section data-background="http://example.com/image.png">
                    <h2>This slide will have a full-size background image.</h2>
                </section>
                <section data-background="http://example.com/image.png" data-background-size="100px" data-background-repeat="repeat">
                    <h2>This background image will be sized to 100px and repeated.</h2>
                </section>
                <section data-background-video="https://s3.amazonaws.com/static.slid.es/site/homepage/v1/homepage-video-editor.mp4,https://s3.amazonaws.com/static.slid.es/site/homepage/v1/homepage-video-editor.webm" data-background-video-loop>
                    <h2>Video. Multiple sources can be defined using a comma separated list. Video will loop when the data-background-video-loop attribute is provided.</h2>
                </section>
                <section data-background-iframe="https://slides.com">
                    <h2>Embeds a web page as a background. Note that the page won't be interactive.</h2>
                </section>
                <section data-transition="zoom">
                    <h2>This slide will override the presentation transition and zoom!</h2>
                </section>

                <section data-transition-speed="fast">
                    <h2>Choose from three transition speeds: default, fast or slow!</h2>
                </section>

                <section data-transition="slide">
                    The train goes on … 
                </section>
                <section data-transition="slide"> 
                    and on … 
                </section>
                <section data-transition="slide-in fade-out"> 
                    and stops.
                </section>
                <section data-transition="fade-in slide-out"> 
                    (Passengers entering and leaving)
                </section>
                <section data-transition="slide">
                    And it starts again.
                </section>
            </div>
        </div>
        <script src="js/reveal.js"></script>
        <script>
            Reveal.initialize({
                
                dependencies: { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
                // Display controls in the bottom right corner
                controls: true,
                // Display a presentation progress bar
                progress: true,
                // Display the page number of the current slide
                slideNumber: false,
                // Push each slide change to the browser history
                history: false,
                // Enable keyboard shortcuts for navigation
                keyboard: true,
                // Enable the slide overview mode
                overview: true,
                // Vertical centering of slides
                center: true,
                // Enables touch navigation on devices with touch input
                touch: true,
                // Loop the presentation
                loop: false,
                // Change the presentation direction to be RTL
                rtl: false,
                // Turns fragments on and off globally
                fragments: true,
                // Flags if the presentation is running in an embedded mode,
                // i.e. contained within a limited portion of the screen
                embedded: false,
                // Flags if we should show a help overlay when the questionmark
                // key is pressed
                help: true,
                // Flags if speaker notes should be visible to all viewers
                showNotes: false,
                // Number of milliseconds between automatically proceeding to the
                // next slide, disabled when set to 0, this value can be overwritten
                // by using a data-autoslide attribute on your slides
                autoSlide: 0,
                // Stop auto-sliding after user input
                autoSlideStoppable: true,
                // Enable slide navigation via mouse wheel
                mouseWheel: false,
                // Hides the address bar on mobile devices
                hideAddressBar: true,
                // Opens links in an iframe preview overlay
                previewLinks: false,
                // Transition style
                transition: 'default', // none/fade/slide/convex/concave/zoom

                // Transition speed
                transitionSpeed: 'default', // default/fast/slow

                // Transition style for full page slide backgrounds
                backgroundTransition: 'default', // none/fade/slide/convex/concave/zoom

                // Number of slides away from the current that are visible
                viewDistance: 3,
                // Parallax background image
                parallaxBackgroundImage: '', // e.g. "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'"

                // Parallax background size
                parallaxBackgroundSize: '', // CSS syntax, e.g. "2100px 900px"

                // Number of pixels to move the parallax background per slide
                // - Calculated automatically unless specified
                // - Set to 0 to disable movement along an axis
                parallaxBackgroundHorizontal: null,
                parallaxBackgroundVertical: null

            });
        </script>
    </body>
</html>